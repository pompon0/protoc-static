# use the following action for debugging:
# https://github.com/mxschmitt/action-tmate
name: static-protoc
on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Release tag'
        required: true
jobs:
  compile:
    name: 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          repository: protocolbuffers/protobuf.git
          ref: main
      - run: bazel build -c opt //:protoc --features=fully_static_link
      - run: echo "UPLOAD_PATH=$(readlink -f bazel-bin/protoc)" >> $GITHUB_ENV 
      - uses: actions/upload-artifact@v3
        with:
          name: protoc
          path: ${{ env.UPLOAD_PATH }}
      - uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          artifactErrorsFailBuild: true
          draft: true
          tag: ${{ github.event.inputs.tag }}
          artifacts: ${{ env.UPLOAD_PATH }}


